/**
 * @preserve Copyright 2011 Syd Lawrence ( www.sydlawrence.com ).
 * Version: 0.2
 *
 * Licensed under MIT and GPLv2.
 *
 * Usage: $('body').videoBG(options);
 *
 */
(function(a){a.fn.videoBG=function(b,d){var d={};if(typeof b=="object"){d=a.extend({},a.fn.videoBG.defaults,b)}else{if(!b){d=a.fn.videoBG.defaults}else{return a(b).videoBG(d)}}var c=a(this);if(!c.length){return}if(c.css("position")=="static"||!c.css("position")){c.css("position","relative")}if(d.width==0){d.width=c.width()}if(d.height==0){d.height=c.height()}var e=a.fn.videoBG.wrapper();e.height(d.height).width(d.width);if(d.textReplacement){d.scale=true;c.width(d.width).height(d.height).css("text-indent","-9999px")}else{e.css("z-index",d.zIndex+1)}e.html(c.clone(true));var f=a.fn.videoBG.video(d);if(d.scale){e.height(d.height).width(d.width);f.height(d.height).width(d.width)}c.html(e);c.append(f);return f.find("video")[0]};a.fn.videoBG.setFullscreen=function(f){var e=a(window).width(),h=a(window).height();f.css("min-height",0).css("min-width",0);f.parent().width(e).height(h);if(e/h>f.aspectRatio){f.width(e).height("auto");var b=f.height();var c=(b-h)/2;if(c<0){c=0}f.css("top",-c)}else{f.width("auto").height(h);var g=f.width();var c=(g-e)/2;if(c<0){c=0}f.css("left",-c);if(c===0){var d=setTimeout(function(){a.fn.videoBG.setFullscreen(f)},500)}}a("body > .videoBG_wrapper").width(e).height(h)};a.fn.videoBG.video=function(e){a("html, body").scrollTop(-1);var b=a("<div/>");b.addClass("videoBG").css("position",e.position).css("z-index",e.zIndex).css("top",0).css("left",0).css("height",e.height).css("width",e.width).css("opacity",e.opacity).css("overflow","hidden");var d=a("<video/>");d.css("position","absolute").css("z-index",e.zIndex).attr("poster",e.poster).css("top",0).css("left",0).css("min-width","100%").css("min-height","100%");if(e.autoplay){d.attr("autoplay",e.autoplay)}if(e.fullscreen){d.bind("canplay",function(){d.aspectRatio=d.width()/d.height();a.fn.videoBG.setFullscreen(d)});var g;a(window).resize(function(){clearTimeout(g);g=setTimeout(function(){a.fn.videoBG.setFullscreen(d)},100)});a.fn.videoBG.setFullscreen(d)}var c=d[0];if(e.loop){loops_left=e.loop;d.bind("ended",function(){if(loops_left){c.play()}if(loops_left!==true){loops_left--}})}d.bind("canplay",function(){if(e.autoplay){c.play()}});if(a.fn.videoBG.supportsVideo()){if(a.fn.videoBG.supportType("webm")){d.attr("src",e.webm)}else{if(a.fn.videoBG.supportType("mp4")){d.attr("src",e.mp4)}else{d.attr("src",e.ogv)}}}var f=a("<img/>");f.attr("src",e.poster).css("position","absolute").css("z-index",e.zIndex).css("top",0).css("left",0).css("min-width","100%").css("min-height","100%");if(a.fn.videoBG.supportsVideo()){b.html(d)}else{b.html(f)}if(e.textReplacement){b.css("min-height",1).css("min-width",1);d.css("min-height",1).css("min-width",1);f.css("min-height",1).css("min-width",1);b.height(e.height).width(e.width);d.height(e.height).width(e.width);f.height(e.height).width(e.width)}if(a.fn.videoBG.supportsVideo()){c.play()}return b};a.fn.videoBG.supportsVideo=function(){return(document.createElement("video").canPlayType)};a.fn.videoBG.supportType=function(c){if(!a.fn.videoBG.supportsVideo()){return false}var b=document.createElement("video");switch(c){case"webm":return(b.canPlayType('video/webm; codecs="vp8, vorbis"'));break;case"mp4":return(b.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"'));break;case"ogv":return(b.canPlayType('video/ogg; codecs="theora, vorbis"'));break}return false};a.fn.videoBG.wrapper=function(){var b=a("<div/>");b.addClass("videoBG_wrapper").css("position","absolute").css("top",0).css("left",0);return b};a.fn.videoBG.defaults={mp4:"",ogv:"",webm:"",poster:"",autoplay:true,loop:true,scale:false,position:"absolute",opacity:1,textReplacement:false,zIndex:0,width:0,height:0,fullscreen:false,imgFallback:true}})(jQuery);
